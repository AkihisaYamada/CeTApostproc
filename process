#!/bin/bash

result=`sed 1q "$1"`
echo bare-result=$result


if [ "$result" = "YES" ]; then
	claim='<terminating/>'
elif [ "$result" = "NO" ]; then
	claim='<nonterminating/>'
else
	claim=
fi

if [ -n "$claim" -a -f "$3/cpf.xml" ]; then
	claimfile=`mktemp`
	errfile=`mktemp`
	timefile=`mktemp`
	echo $claim > "$claimfile"
	cert=`/usr/bin/time --quiet -o "$timefile" -f %U ./ceta "$2" "$claimfile" "$3/cpf.xml" 2> "$errfile"`
	echo starexec-result=$cert $result
	echo certification-result=$cert
	echo certification-err=`cat "$errfile"`
	echo certification-time=`cat "$timefile"`
	rm "$claimfile" "$errfile" "$timefile"
	cp "$3/cpf.xml" "$1"
else
	sed -n '1!p' -i "$1"
	echo starexec-result=$result
fi
